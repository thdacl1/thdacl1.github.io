<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek AI Chat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h2>DeepSeek AI Chat</h2>
        </div>
        <div class="chat-box" id="chatBox"></div>
    </div>

    <!-- Phần nhập dữ liệu cố định ở phía dưới màn hình -->
    <div class="input-container">
        <textarea id="userInput" placeholder="Nhập câu hỏi của bạn..." rows="2"></textarea>
        <button onclick="getAIResponse()">Gửi</button>
        <input type="file" id="fileInput" onchange="handleFileSelect(event)" style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">Tải lên file</button>
    </div>

    <script>
        async function getAIResponse() {
            const userInput = document.getElementById("userInput").value;
            const chatBox = document.getElementById("chatBox");
            const responseDiv = document.createElement("div");
            responseDiv.classList.add("user-message");
            responseDiv.innerHTML = "<strong>Bạn:</strong> " + userInput;
            chatBox.appendChild(responseDiv);

            const loadingDiv = document.createElement("div");
            loadingDiv.classList.add("ai-message");
            loadingDiv.innerHTML = "<strong>AI:</strong> Đang xử lý...";
            chatBox.appendChild(loadingDiv);
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch("https://api.novita.ai/v3/openai/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer sk_XUEQztNwoL_vDz7R-IMYcPQRCfbNCfx2hn_MWORs_Hg"
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1",
                        messages: [
                            { "role": "system", "content": "Hãy là một trợ lý hữu ích" },
                            { "role": "user", "content": userInput }
                        ],
                        response_format: { "type": "text" },
                        max_tokens: 1024,  
                        temperature: 0.6,
                        top_p: 1,
                        presence_penalty: 0,
                        frequency_penalty: 0,
                        repetition_penalty: 1,
                        top_k: 50,
                        min_p: 0
                    })
                });

                const data = await response.json();
                loadingDiv.innerHTML = "<strong>AI:</strong> " + data.choices[0].message.content;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                loadingDiv.innerHTML = "<strong>AI:</strong> Đã xảy ra lỗi, vui lòng thử lại!";
                console.error(error);
            }
            document.getElementById("userInput").value = ""; // Xóa nội dung hộp nhập
        }

        function handleFileSelect(event) {
            const fileInput = event.target;
            const chatBox = document.getElementById("chatBox");
            const file = fileInput.files[0];

            if (file) {
                const fileReader = new FileReader();
                fileReader.onload = function(e) {
                    const filePreviewDiv = document.createElement("div");
                    filePreviewDiv.classList.add("file-preview");
                    const fileContent = e.target.result;
                    const fileType = file.type.split('/')[0];

                    if (fileType === 'image') {
                        const img = document.createElement("img");
                        img.src = fileContent;
                        img.alt = "Tải lên hình ảnh";
                        img.style.maxWidth = "300px";
                        filePreviewDiv.appendChild(img);
                    } else {
                        filePreviewDiv.innerHTML = `<strong>File tải lên:</strong> ${file.name}`;
                    }

                    chatBox.appendChild(filePreviewDiv);
                    chatBox.scrollTop = chatBox.scrollHeight;
                };
                fileReader.readAsDataURL(file);
            }
        }
    </script>
</body>
</html>
